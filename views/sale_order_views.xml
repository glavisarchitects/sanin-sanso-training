<?xml version="1.0" encoding="utf-8" ?>
<odoo>
    <data>

        <record id="view_order_form" model="ir.ui.view">
            <field name="name">sale.order.view.form.inherit</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form" />
            <field name="arch" type="xml">
                <button name="action_quotation_send" position="before">
                    <button name="action_request_approval" string="Request Approval"
                        type="object" attrs="{'invisible': [('approval_state', 'not in', ['draft', 'remanded'])]}"
                        groups="sales_team.group_sale_salesman" />
                    <button name="action_cancel_request_approval" string="Cancel Request"
                        type="object" attrs="{'invisible': [('approval_state', '!=', 'requested')]}"
                        groups="sales_team.group_sale_salesman"
                        confirm="This action will revert your approval request for this quotation. Do you wish to continue?"/>
                    <button name="action_response_to_request_approval" string="Response Approval"
                        type="object" attrs="{'invisible': [('approval_state', '!=', 'requested')]}" />
                </button>
                <xpath expr="//div[hasclass('oe_title')]" position="before">
                    <field name="crm_team_id" nolabel="1" class="oe_avatar" />
                </xpath>
                <field name="show_update_pricelist" position="before">
                    <field name="approval_date_ends"
                        attrs="{'invisible': [('approval_state', 'in', ['approved', 'rejected'])]}" />
                    <field name="approval_state" invisible="1" />
                </field>
                <group name="order_details" position="inside">
                    <field name="delivery_info" />
                </group>
                <xpath expr="//page[@name='order_lines']/field[@name='order_line']/tree/field[@name='name']" position="after">
                    <field name="supervise_group_id" optional="show" />
                </xpath>
                <xpath expr="//page[@name='order_lines']/field[@name='order_line']/tree/field[@name='tax_id']" position="before">
                    <field name="campaign_id" optional="show" />
                </xpath>
            </field>
        </record>

        <record id="view_quotation_tree" model="ir.ui.view">
            <field name="name">sale.order.view.tree.inherit</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_quotation_tree" />
            <field name="arch" type="xml">
                <field name="state" position="after">
                    <field name="approval_state" optional="show" />
                </field>
            </field>
        </record>

        <record id="sale_order_view_search_inherit_quotation" model="ir.ui.view">
            <field name="name">sale.order.view.search.inherit</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.sale_order_view_search_inherit_quotation" />
            <field name="arch" type="xml">
                <filter name="sales" position="after">
                    <separator />
                    <filter string="Approve Requests" name="fltr_request_approve" domain="[('approval_state','=', 'requested')]"/>
                    <filter string="Approved Quotations" name="fltr_approved" domain="[('approval_state','=', 'approved')]"/>
                    <filter string="Rejected Quotations" name="fltr_rejected" domain="[('approval_state','=', 'rejected')]"/>
                    <filter string="Remanded Quotations" name="fltr_remanded" domain="[('approval_state','=', 'remanded')]"/>
                </filter>
                <xpath expr="." position="inside">
                    <filter name="grp_approval_state" string="Approval States"
                        context="{'group_by': 'approval_state'}" />
                </xpath>
            </field>
        </record>

    </data>
</odoo>
